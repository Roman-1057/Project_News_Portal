$(document).ready(function(){$(".search-yandex-box").removeClass("invisible");$(".box-filter-ok span").click(function(){$('.box-filter-ok span[class="active"]').removeClass("active");$(this).addClass("active");$("span[data-filter]").removeClass("marked");$('span[data-filter="'+$(this).html()+'"]').addClass("marked")});$('span[action="show_update_content"]').click(function(){const update_id=$(this).attr("update_id");const update_content_id="update_content_"+update_id;const $div_update_content=$("#"+update_content_id);if($div_update_content.length){$div_update_content.is(":visible")?$div_update_content.hide(500):$div_update_content.show(500);return}parent=$(this).parent().parent();parent.after('<tr id="${update_content_id}" class="small"><td></td><td colspan="3" id="doc_${update_content_id}">Загружается информация по документу <i class="fa fa-spin fa-spinner"></i></td></tr>');$.ajax({type:"POST",url:"/assets/json/update-content.json",data:{update_id:update_id}}).done(function(data){if(data.status==="ok"){let html=" ↳ ";if(data.doc_note!==""){html+=`Изменение ${data.doc_name} введено ${data.doc_note}<br>`}if(data.doc_content!==""){html+=data.doc_content}$("#doc_"+update_content_id).html(html)}else{$("#doc_"+update_content_id).html(`<span class="text-muted"> ↳ ${data.text}</span>`)}}).fail(function(){$("#doc_"+update_content_id).html("Произошла ошибка при загрузке данных.")})});$("#frm-search-by-code").submit(function(){$("#btn-search-by-code").prop("disabled",true).html('<i class="fa fa-spinner fa-spin"></i>');$("#frm-search-by-code-msg").removeClass("text-danger").html("");$.ajax({type:"POST",url:"/assets/json/search-code.json",data:$("#frm-search-by-code").serialize()}).done(function(data){if(data.status==="ok"){$("#frm-search-by-code-msg").html(`${data.ok_short_name}: <a href="/${data.url}/${data.code}">${format_code(data.code,data.url)}</a> &mdash; <a href="/${data.url}/${data.code}">${data.name}</a>`)}else if(data.status==="notfound"){$("#frm-search-by-code-msg").addClass("text-danger").html(`<i class="fa fa-info-circle"></i> Код ${data.code} не найден.`)}else if(data.status==="deleted"){$("#frm-search-by-code-msg").addClass("text-danger").html(`<i class="fa fa-info-circle"></i> Код <a href="/${data.url}/${data.code.replace(/ /g,"")}">${format_code(data.code,data.url)}</a> исключён из классификатора ${data.ok_short_name} изменением <a href="/updates/${data.url}/${data.num_update}">№${data.num_update}/${data.num_year}</a>`)}else{$("#frm-search-by-code-msg").addClass("text-danger").html(`<i class="fa fa-warning"></i> ${data.text}`)}}).fail(function(){$("#frm-search-by-code-msg").addClass("text-danger").html("<p>Произошёл сбой в системе поиска. Попробуйте позже. Приносим извинения за неудобства.</p>")}).always(function(){$("#btn-search-by-code").prop("disabled",false).html('<i class="fa fa-search"></i>')});return false});$("#frm-search-group-okof-by-code").submit(function(){$("#btn-search-group-okof-by-code").prop("disabled",true).html('<i class="fa fa-spinner fa-spin"></i>');$("#frm-search-group-okof-by-code-msg").removeClass("text-danger").html("");$.ajax({type:"POST",url:"/assets/json/search-group-okof.json",data:$("#frm-search-group-okof-by-code").serialize()}).done(function(data){if(data.status==="ok"){let res=`<br><p><span class="text-bold">Код:</span> <a href="/okof/${data.code}">${data.code}</a><br><span class="text-bold">Наименование:</span> ${data.name}<br>Найдено групп: ${data.groups.length}</p><p>`;data.groups.forEach(function(group){res+=`<span class="text-bold">Группа:</span>
                            ${group.group_name} &rarr; ${group.cat_name}<br>
                            <span class="text-bold">Сроки:</span> ${group.group_note}<br>
                            <span class="text-bold">Примечание:</span> ${group.note??"&mdash;"}`});res+="</p>";$("#frm-search-group-okof-by-code-msg").html(res)}else if(data.status==="notfound"){$("#frm-search-group-okof-by-code-msg").html(`<i class="fa fa-info-circle"></i> ${data.text}`).addClass("text-danger")}else{$("#frm-search-group-okof-by-code-msg").html(`<i class="fa fa-warning"></i> ${data.text}`).addClass("text-danger")}}).fail(function(){$("#frm-search-group-okof-by-code-msg").html("<p>Произошёл сбой в системе поиска. Попробуйте позже. Приносим извинения за неудобства.</p>").addClass("text-danger")}).always(function(){$("#btn-search-group-okof-by-code").prop("disabled",false).html('<i class="fa fa-search"></i> Найти')});return false});$("#form-comment").submit(function(){$("#form-comment button").prop("disabled",true);$("#form-comment-message").removeClass("text-success text-danger").html('Сообщение отправляется <i class="fa fa fa-spinner fa-spin"></i>').show();$.ajax({type:"POST",url:"/assets/json/comment.json",data:$("#form-comment").serialize()}).done(function(data){if(data.status==="ok"){$("#form-comment-message").addClass("text-success").html("Мы получили комментарий. Скоро он будет проверен администратором сайта.");$("#form-comment")[0].reset()}else{$("#form-comment-message").addClass("text-danger").html('<i class="fa fa-warning"></i> '+data.error)}}).fail(function(){$("#form-comment-message").addClass("text-danger").html('<i class="fa fa-warning"></i> Сервис временно недоступен. Возможно, обрыв интернет-соединения. Попробуйте ещё раз.')}).always(function(){$("#form-comment button").prop("disabled",false)});return false});$(".btn-picker").click(function(){const obj=$(this).parent().children("span.text-picker");if(obj.length){obj.hasClass("hidden")?$(this).html("детали &uarr;"):$(this).html("детали &darr;");obj.hasClass("hidden")?obj.removeClass("hidden"):obj.addClass("hidden")}})});function format_code(code="",ok_url=""){if(ok_url==="oktmo"){return code.substring(8,11)==="000"?code.substring(0,8):code}return code}